<!DOCTYPE html> <html class="mmmmycbixd idc0_343" style><!--
 Page saved with SingleFile 
 url: https://memex.marginalia.nu/log/69-creepy-website-similarity.gmi 
 saved date: Tue Dec 27 2022 14:17:31 GMT+0000 (Greenwich Mean Time)
--><meta charset=utf-8>
<title>MEMEX - Creepy Website Similarity [ 2022-12-26 ]</title>
<style>body{font-family:sans-serif;font-size:12pt;margin:0px;background-color:#f8f8ee}header{background-color:#acae89;color:#fff;border-bottom:1px solid #888}header nav a{text-decoration:none;color:#000;margin-right:1ch;padding:.5ch;display:inline-block}nav.topbar{display:flex;justify-content:left;align-content:center;background-color:#fff;margin-bottom:4ch;box-shadow:#ccc 4px 4px 5px;max-width:160ch;margin-left:auto;margin-right:auto}nav.topbar h1{padding:.5ch 1ch .5ch .5ch;display:inline-block;margin:0px;background-color:#2f4858;color:#fff;font-weight:normal;font-family:serif;font-size:16pt;border:1px solid #fff}nav.topbar a{padding:1ch;text-decoration:none;color:#000;border-right:2px solid #ccc;padding-top:1.20ch;display:flex;align-items:center;gap:1ch}nav.topbar>*:last-child{background:#3F5F6F!important;color:#fff}header nav a:hover,header nav a:focus{background:#2f4858;color:#fff!important}article a:focus{color:#fff!important;text-shadow:0 0 5px #f00;background-color:#000!important;;outline:none}article{max-width:160ch;margin-left:auto;margin-right:auto;display:flex}article>#memex-node{line-height:1.6;margin:1ch 2ch 2ch 2ch;padding:0ch 1ch 1ch 1ch;flex-basis:60ch;border:2px #ccc;background-color:#fff;border-left:1px solid #ecb;border-top:1px solid #ecb;box-shadow:#0008 0 0 5px;max-width:60ch;overflow:auto}pre{font-size:8pt;overflow:auto}#memex-node h1,article #memex-node h2{margin:0px 0px 1ch 0px;font-size:12pt;font-weight:normal;margin-left:-1.6ch;margin-right:-0.6ch;background-color:#2f4858;color:#fff;padding:0.75ch 1ch 0.5ch 1.5ch;box-shadow:#000a 4px 4px}#sidebar>*{padding:1ch}#sidebar h1{margin-top:0;font-size:12pt;font-weight:normal;margin-left:-1.6ch;margin-right:-0.6ch;background-color:#2f4858;color:#fff;padding:0.5ch 1ch 0.5ch 1ch;box-shadow:#000a 4px 4px}article dl{margin:0px}#sidebar a{color:#000}.toc{margin-top:1ch}.toc a{display:block}footer{padding:2ch;margin:16ch 0px 0px 0px;background-color:#acae89;height:20ch;font-size:10pt}@media only screen and (max-device-width:800px){header nav a{padding:1ch!important}.topbar{flex-direction:column}article{flex-direction:column}#memex-node{flex-basis:unset!important}}@media (prefers-color-scheme:dark){a{color:#acf}header{background-color:#000}article #memex-node{border:unset}header nav a{color:#eee}nav.topbar{background:#222;box-shadow:#0008 0 0 5px}nav.topbar a{color:#eee}nav.topbar h1{background-color:unset;border-right:2px solid #444;border-left:none;border-top:none;border-bottom:none}footer{background-color:#000;color:#fff}body{background-color:#444}#sidebar{color:#fff}#sidebar a{color:#ccc}#memex-node{background-color:#222!important;color:#aaa;box-shadow:#0008 0 0 5px}}</style>
<meta name=viewport content="width=device-width, initial-scale=1.0">
<link type=image/x-icon rel="shortcut icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpSKVglYQcchQnSyIijpqFYpQIdQKrTqYXPoFTRqSFhdHwbXg4Mdi1cHFWVcHV0EQ/ABxc3NSdJES/5cUWsR4cNyPd/ced+8AoV5imtUxBmh6xUzGY2I6syoGXuFHP3oxjZDMLGNOkhLwHF/38PH1LsqzvM/9OXrUrMUAn0g8ywyzQrxBPLVZMTjvE4dZQVaJz4lHTbog8SPXFZffOOcdFnhm2Ewl54nDxGK+jZU2ZgVTI54kjqiaTvlC2mWV8xZnrVRlzXvyFwaz+soy12kOIY5FLEGCCAVVFFFCBVFadVIsJGk/5uEfdPwSuRRyFcHIsYAyNMiOH/wPfndr5SbG3aRgDOh8se2PYSCwCzRqtv19bNuNE8D/DFzpLX+5Dsx8kl5raZEjILQNXFy3NGUPuNwBBp4M2ZQdyU9TyOWA9zP6pgzQdwt0r7m9Nfdx+gCkqKvEDXBwCIzkKXvd491d7b39e6bZ3w+EonKuYzVYaAAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+UDFRMHMjPMJ4IAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACk0lEQVRYw+2XzW7TUBCFv5kb23FapJS+CrDooiIFsUJC/D4HCNFN1b4BrdTXYNEqsAIEiMfoM1ChpoX8+PoOi7hOQlxUkkI3PdJsfC3f8Zlzjq/l+KTHZUK5ZFw1cOkN1KovBwC899TjdOyqTKxPwvA+I8sykiS9GAaWmk1LG1FZC4u1opKKqtvy8rLt7Oxc7AiOO116XV9UXpSvqIyjoyPMzLa2tmg0knlGoAXNhjg4/P6Ng4MDLAypH6jizDDxRLlixXuIBuLIkcTXrPuzKzXn8LnNL8Jms4lZYG+/zd5+m4Z5EnLqJjg1nA4bbbXu4JxjY2OD3d1d897jnPs3Lniz964sIWAS+PLl01COFlhff8X29mv78OE9YEWdewQjSFEuTL7J04f3x/TvEAK3b68Bgc3NzXLt+YuXtrbWktHT/rKBchMJPHvwGNP+mfe02/ssLi5iZqysrJCmKXmezyLCimQQYxB53r55N7X26Mk9xC/RvGb0a4HE61B8EhdT1vkbAGhkNkE9QC4BlyvIDwASr/8misWEIFUJOPL7auvu6MGqYH7WHJiGMwEZqv93nLLy9fPHUVvJXEFUxUCE4adGcBa63f7FjsAk/8ukGPo+imrz5cAoDwLGn0cwDu8zECHLBmObz5EDAUUqNlNTQvF5Xm3dLXUQx/HFaKAkTrIz8mHkjHERCjFUumZGDWSq1OT4f52IJtHpdLh18wbqIw4X+iwM6kQ2IM4Vr0Ke5yRJgvdD3+ehRwhhHheEkkjnHGmactI5wVzgei8iCTlqDq8CBJwTvB+UaneaYGQQdCyKdTYG0nr9/LYTm/qUNhqN2UfQ6/fllEpVR5b5SraGhw7BKqyuquVoKu199Wt21cBlN/ALqO0yElqlWTEAAAAASUVORK5CYII=" data-sf-original-href=https://memex.marginalia.nu/favicon.ico><link rel=canonical href=https://memex.marginalia.nu/log/69-creepy-website-similarity.gmi><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class=double lang=en>
<header>
 <nav>
 <a href=http://www.marginalia.nu/>Marginalia</a>
 <a href=http://search.marginalia.nu/>Search Engine</a>
 <a href=http://encyclopedia.marginalia.nu/>Encyclopedia</a>
 </nav>
</header>
<nav class=topbar>
 <h1>Memex</h1>
 <a href=https://memex.marginalia.nu/ class="path root"><img src=data:, title=root data-sf-original-src=https://memex.marginalia.nu/ico/root.png> marginalia</a>
 <a href=https://memex.marginalia.nu/log class="path dir"><img src=data:, title=dir data-sf-original-src=https://memex.marginalia.nu/ico/dir.png> log</a>
 <a href=https://memex.marginalia.nu/log/69-creepy-website-similarity.gmi class="path file"><img src=data:, title=file data-sf-original-src=https://memex.marginalia.nu/ico/file.png> 69-creepy-website-similarity.gmi</a>
</nav>
<article>
<section id=memex-node>
<h1 id=1>Creepy Website Similarity [ 2022-12-26 ]</h1>
<br>
This is a write-up about an experiment from a few months ago, in how to find websites that are similar to each other. Website similarity is useful for many things, including discovering new websites to crawl, as well as suggesting similar websites in the Marginalia Search random exploration mode.<br>
<br>
<dl class=link><dt><a class=external href=https://explore2.marginalia.nu/>https://explore2.marginalia.nu/</a><dd>A link to a slapdash interface for exploring the experimental data.</dl>
<br>
The approach chosen was to use the link graph look for websites that are linked to from the same websites. This turned out to work remarkably well. <br>
<br>
There are some alternative feature spaces that might have been used, such as TF-IDF data. Using incident links turned out to be surprisingly powerful, almost to an uncanny degree as it's able to find similarities even among websites that Marginalia doesn't index.<br>
<br>
As a whole the feature shares a lot of similarity with how you would construct a recommendation algorithm of the type "other shoppers also bought", and in doing so also exposes how creepy they can be. You can't build a recommendation engine without building a tool for profiling. It's largely the same thing.<br>
<br>
If you for example point the website explorer to the fringes of politics, it will map that web-space with terrifying accuracy.<br>
<br>
<dl class=link><dt><a class=external href="https://explore2.marginalia.nu/search?domain=qanon.pub">https://explore2.marginalia.nu/search?domain=qanon.pub</a><dd>qanon.pub's neighbors</dl>
<br>
Note again how few of those websites are actually indexed by Marginalia. Only those websites with 'MS' links are! The rest are inferred from the data. On the one hand it's fascinating and cool, on the other it's deeply troubling: If I can create such a map on PC in my living room, imagine what might be accomplished with a datacenter.<br>
<br>
You might think "Well what's the problem? QAnon deserves all the scrutiny, give them nowhere to hide!". Except this sort of tool could concievably work just as well as well for mapping democracy advocates in Hong Kong, Putin-critics in Russia, gay people in Uganda, and so forth.<br>
<br>
<h2 id=1.1>Implementation details</h2>
<br>
In practice, cosine similarity is used to compare the similarity between websites. This is a statistical method perhaps most commonly used in machine learning, but it has other uses as well. <br>
<br>
Cosine similarity is calculated by taking the inner product of two vectors and dividing by their norms<br>
<br>
<pre>       a x b
  p = --------- 
      |a| |b|</pre>
<br>
As you might remember from linear algebra, this is a measure of how much two vectors "pull in the same direction". The cosine similarity of two identical vectors is unity, and for orthogonal vectors it is zero.<br>
<br>
This data has extremely high dimensionality, the vector space consists of nearly 10 million domains, so most "standard" tools like numpy/scipy will not load the data without serious massaging. That juice doesn't appear to be worth the squeeze when it's just as easy to roll what you need on your own (which you'd probably need to do regardless to get it into those tools, Random Reprojection or some such). <br>
<br>
Since the vectors in questions are just bitmaps, either a website has a link or it does not, the vector product can be simplified to a logical AND operation. The first stab at the problem was to use RoaringBitmaps.<br>
<br>
<pre>    double cosineSimilarity(RoaringBitmap a, RoaringBitmap b) {
        double andCardinality = RoaringBitmap.andCardinality(a, b);
        andCardinality /= Math.sqrt(a.getCardinality());
        andCardinality /= Math.sqrt(b.getCardinality());
        return andCardinality;
    }
</pre>
<br>
This works but it's just a bit too slow to be practical. Sacrificing some memory for speed turns out to be necessary. Roaring Bitmaps are memory efficient, but a general purpose library. It's easy to create a drop-in replacement that implements only andCardinality() and getCardinality() in a way that caters to the specifics of the data. <br>
<br>
A simple 64 bit bloom filter makes it possible to short-circuit a lot of the calculations since many vectors are small and trivially don't overlap. The vector data is stored in sorted lists. Comparing sorted lists is very cache friendly and fast, while using relatively little memory. Storing a dense matrix would require RAM on the order of hundreds of terabytes so that's no good.<br>
<br>
The actual code rewritten for brevity, as a sketch the and-cardinality calculation looks like this, and performs about 5-20x faster than RoaringBitmaps for this specfic use case:<br>
<br>
<pre>    int andCardinality(AndCardIntSet a, AndCardIntSet b) {

        if ((a.hash &amp; b.hash) == 0) {
            return 0;
        }

        int i = 0, j = 0;
        int card = 0;

        do {
            int diff = a.backingList.getQuick(i) - b.backingList.getQuick(j);

            if (diff &lt; 0) i++;
            else if (diff &gt; 0) j++;
            else {
                i++;
                j++;
                card++;
            }
        } while (i &lt; a.getCardinality() &amp;&amp; j &lt; b.getCardinality());

        return card;
        
     }
</pre>
<br>
This calculates similarities between websites at a rate where it's feasible to pre-calculate the similarities between all known websites within a couple of days. It's on the cusp of being viable to offer ad-hoc calculations, but not quite without being a denial of service-hazard. <br>
<br>
To do this in real time, the search space could be reduced using some form of locality-sensitive hash scheme, although for a proof of concept this performs well enough on its own. <br>
<br>
<h2 id=1.2>Closing thoughts</h2>
<br>
This has been online for a while and I've been debating whether to do this write-up. To be honest this is probably the creepiest piece of software I've built. <br>
<br>
At the same time, I can't imagine I'm the first to conceive of doing this. To repeat, you almost can't build a suggestions engine without this type of side-effect, and recommendations are *everywhere* these days. They are on Spotify, Youtube, Facebook, Reddit, Twitter, Amazon, Netflix, Google, even small web shops have them. <br>
<br>
In that light, it's better to make the discovery public and highlight its potential so that it might serve as an example of how and why these recommendation algorithms are profoundly creepy. <br>
<br>
<h2 id=1.3>Topic</h2>
<br>
<a class=internal href=https://memex.marginalia.nu/topic/astrolabe.gmi>/topic/astrolabe.gmi</a><br>
<a class=internal href=https://memex.marginalia.nu/topic/programming.gmi>/topic/programming.gmi</a><br>
</section>
<div id=sidebar>
<section class=tools>
 <h1>69-creepy-website-similarity.gmi</h1>
 <a class=download href="https://memex.marginalia.nu/api/raw?url=/log/69-creepy-website-similarity.gmi">Raw</a><br>
 <a rel=nofollow href="https://memex.marginalia.nu/api/update?url=/log/69-creepy-website-similarity.gmi" class=verb>Edit</a>
 <a rel=nofollow href="https://memex.marginalia.nu/api/rename?type=gmi&amp;url=/log/69-creepy-website-similarity.gmi" class=verb>Rename</a>
 <a rel=nofollow href="https://memex.marginalia.nu/api/delete?type=gmi&amp;url=/log/69-creepy-website-similarity.gmi" class=verb>Delete</a>
 <br>
 <div class=toc>
 
 <a href=#1 class=heading-1>1 Creepy Website Similarity [ 2022-12-26 ]</a>
 
 <a href=#1.1 class=heading-2>1.1 Implementation details</a>
 
 <a href=#1.2 class=heading-2>1.2 Closing thoughts</a>
 
 <a href=#1.3 class=heading-2>1.3 Topic</a>
 
 </div>
</section>
</div>
</article>
<footer>
 Reach me at <a class=fancy-teknisk href=mailto:kontakt@marginalia.nu>kontakt@marginalia.nu</a>.
 <br>
</footer>
<script>document.currentScript.remove();!function(){"use strict";(t=>{const n="singlefile-infobar",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8H+DhhoQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJJJREFUOI3t070NRCEMA2CnYAOyDyPwpHj/Va7hJ3FzV7zy3ET5JIwoAF6Jk4wzAJAkzxAYG9YRTgB+24wBgKmfrGAKTcEfAY4KRlRoIeBTgKOCERVaCPgU4Khge2GqKOBTgKOCERVaAEC/4PNcnyoSWHpjqkhwKxbcig0Q6AorXYF/+A6eIYD1lVbwG/jdA6/kA2THRAURVubcAAAAAElFTkSuQmCC",o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8VC4EQ6QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJtJREFUOI3NkrsBgCAMRLFwBPdxBArcfxXFkO8rbKWAAJfHJ9faf9vuYX/749T5NmShm3bEwbe2SxeuM4+2oxDL1cDoKtVUjRy+tH78Cv2CS+wIiQNC1AEhk4AQeUTMWUJMfUJMSEJMSEY8kIx4IONroaYAimNxsXp1PA7PxwfVL8QnowwoVC0lig07wDDVUjAdbAnjwtow/z/bDW7eI4M2KruJAAAAAElFTkSuQmCC",i="SingleFile",A="single-file-ui-element",r="\n\t.infobar {\n\t\tbackground-color: #737373;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\ttop: 16px;\n\t\tright: 16px;\n\t\theight: auto;\n\t\twidth: auto;\n\t\tmin-height: 24px;\n\t\tmin-width: 24px;\n\t\tbackground-position: center;\n\t\tbackground-repeat: no-repeat;\n\t\tz-index: 2147483647;\n\t\tmargin: 0 0 0 16px;\n\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHADIRLMaOHwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAPUExURQAAAIqKioyNjY2OjvDw8L2y1DEAAAABdFJOUwBA5thmAAAAAWJLR0QB/wIt3gAAAGNJREFUSMdjYCAJsLi4OBCQx6/CBQwIGIDPCBcXAkYQUsACU+AwlBVQHg6Eg5pgZBGOboIJZugDFwRwoJECJCUOhJI1wZwzqmBUwagCuipgIqTABG9h7YIKaKGAURAFEF/6AQAO4HqSoDP8bgAAAABJRU5ErkJggg==);\n\t\tborder-radius: 16px;\n\t\tuser-select: none;\n\t\t-moz-user-select: none;\n\t\topacity: .7;\n\t\tcursor: pointer;\n\t\tpadding-left: 0;\n\t\tpadding-right: 0;\n\t\tpadding-top: 0;\n\t\tpadding-bottom: 0;\n\t\tborder: 2px solid #eee;\n\t\tbackground-size: 70% 70%;\n\t\ttransition: all 250ms;\n\t\tfont-size: 13px;\n\t}\n\t.infobar:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open {\n\t\topacity: 1;\n\t\tbackground-color: #f9f9f9;\n\t\tcursor: auto;\n\t\tcolor: #2d2d2d;\n\t\tpadding-top: 2px;\n\t\tpadding-bottom: 2px;\n\t\tborder: 2px solid #878787;\n\t\tbackground-image: none;\n\t\tborder-radius: 8px;\n\t\tuser-select: initial;\n\t\t-moz-user-select: initial;\n\t}\n\t.infobar-close-button {\n\t\tdisplay: none;\n\t\topacity: .7;\n\t\tpadding-top: 4px;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tcursor: pointer;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-close-button:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-content {\n\t\tdisplay: none;\n\t\tfont-family: Arial;\n\t\tfont-size: 14px;\n\t\tline-height: 22px;\n\t\tword-break: break-word;\n\t\twhite-space: pre-wrap;\n\t\tposition: relative;\n\t\ttop: 1px;\n\t\ttext-align: left;\n\t}\n\t.infobar-link {\n\t\tdisplay: none;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tline-height: 11px;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t\toutline: 0;\n\t}\n\t.infobar-link-icon {\n\t\tpadding-top: 4px;\n\t\tpadding-left: 2px;\n\t\tcursor: pointer;\n\t\topacity: .7;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-link-icon:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open .infobar-close-button, .infobar-open .infobar-content, .infobar-open .infobar-link {\n\t\tdisplay: inline-block;\n\t}";let a=!0;const c=t.browser;async function s(){const t=document.evaluate("//comment()",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);let s=t&&t.singleNodeValue;if(s&&((p=s).nodeType==Node.COMMENT_NODE&&p.textContent.includes(i))){const t=s.textContent.split("\n"),[,,i,p,...g]=t,h=i.match(/^ url: (.*) $/),u=h&&h[1];if(u&&p){let t;if(c&&c.runtime&&c.runtime.sendMessage)try{t=await c.runtime.sendMessage({method:"tabs.getOptions",url:u})}catch(n){t={displayInfobar:!0}}else t={displayInfobar:!0};t.displayInfobar&&await async function(t,i,c){let s=document.querySelector(n);if(!s){if(i=i.split("saved date: ")[1],c&&c.length>1){let t=c[0].split("info: ")[1].trim();for(let n=1;n<c.length-1;n++)t+="\n"+c[n].trim();c=t.trim()}else c=i;s=d(n,document.body),s.className=A;const p=await async function(t){if(t.attachShadow)return t.attachShadow({mode:"open"});{a=!1;const n=d("iframe",t);return n.style.setProperty("background-color","transparent","important"),n.style.setProperty("position","fixed","important"),n.style.setProperty("top",0,"important"),n.style.setProperty("right",0,"important"),n.style.setProperty("width","44px","important"),n.style.setProperty("height","48px","important"),n.style.setProperty("z-index",2147483647,"important"),new Promise((t=>{n.contentDocument.body.style.setProperty("margin",0),n.onload=()=>t(n.contentDocument.body)}))}}(s),g=document.createElement("style");g.textContent=r,p.appendChild(g);const h=document.createElement("div");h.classList.add("infobar"),p.appendChild(h);const u=document.createElement("img");u.classList.add("infobar-close-button"),h.appendChild(u),u.src=o,u.onclick=t=>{0===t.button&&s.remove()};const m=document.createElement("span");h.appendChild(m),m.classList.add("infobar-content"),m.textContent=c;const b=document.createElement("a");b.classList.add("infobar-link"),h.appendChild(b),b.target="_blank",b.rel="noopener noreferrer",b.title="Open source URL: "+t,b.href=t;const f=document.createElement("img");f.classList.add("infobar-link-icon"),b.appendChild(f),f.src=e,l(h),document.addEventListener("click",(t=>{if(0===t.button){let n=t.target;for(;n&&n!=s;)n=n.parentElement;n!=s&&l(h)}}))}}(u,p,g)}}var p}function l(t){if(t.classList.remove("infobar-open"),t.onclick=e=>{if(0===e.button)return function(t){a||document.querySelector(n).childNodes[0].contentWindow.getSelection().removeAllRanges();if(t.classList.add("infobar-open"),t.onclick=null,t.onmouseout=null,!a){const e=document.querySelector(n).childNodes[0];e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("width",t.getBoundingClientRect().width+33+"px","important"),e.style.setProperty("height",t.getBoundingClientRect().height+21+"px","important")}}(t),!1},!a){const t=document.querySelector(n).childNodes[0];t.style.setProperty("width","44px","important"),t.style.setProperty("height","48px","important")}}function d(t,n){const e=document.createElement(t);return n.appendChild(e),Array.from(getComputedStyle(e)).forEach((t=>e.style.setProperty(t,"initial","important"))),e}t.window==t.top&&("loading"==document.readyState?document.addEventListener("DOMContentLoaded",s,!1):s())})("object"==typeof globalThis?globalThis:window)}();
</script>